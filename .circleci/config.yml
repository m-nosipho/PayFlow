version: 2.1

orbs:
  sonarcloud: sonarsource/sonarcloud@1.1.1

jobs:
  build:
    docker:
      - image: cimg/dotnet:8.0.0
    steps:
      - checkout

      - run:
          name: Install unzip
          command: sudo apt-get update && sudo apt-get install -y unzip

      - run:
          name: Install Java 17
          command: |
            sudo apt-get install -y openjdk-17-jdk
            sudo update-alternatives --install /usr/bin/java java /usr/lib/jvm/java-17-openjdk-amd64/bin/java 1
            java -version

      - run:
          name: Install Dependencies
          command: dotnet restore

      - run:
          name: Build
          command: dotnet build --no-restore

      - run:
          name: Run Tests
          command: dotnet test --no-build

      - sonarcloud/scan

workflows:
  build_and_analyze:
    jobs:
      - build
